<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GGStandoff WebApp</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #ffffff;
            min-height: 100vh;
            padding: 16px;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
        }

        /* –ü—Ä–∏–≤—ñ—Ç–∞–Ω–Ω—è */
        .welcome-card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border-radius: 24px;
            padding: 24px;
            margin-bottom: 24px;
            border: 1px solid rgba(233, 69, 96, 0.3);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            animation: fadeIn 0.5s ease;
        }

        .welcome-title {
            font-size: 28px;
            font-weight: bold;
            background: linear-gradient(45deg, #e94560, #ff6b6b);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 8px;
        }

        .welcome-text {
            color: #a0a0a0;
            line-height: 1.6;
            font-size: 14px;
        }

        /* –ë–∞–ª–∞–Ω—Å */
        .balance-card {
            background: rgba(233, 69, 96, 0.1);
            border: 1px solid #e94560;
            border-radius: 20px;
            padding: 16px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            backdrop-filter: blur(5px);
            animation: slideUp 0.5s ease;
        }

        .balance-label {
            font-size: 16px;
            color: #a0a0a0;
        }

        .balance-amount {
            font-size: 24px;
            font-weight: bold;
            color: #e94560;
            text-shadow: 0 0 10px rgba(233, 69, 96, 0.5);
        }

        /* –ú–µ–Ω—é */
        .menu-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin-bottom: 24px;
        }

        .menu-item {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 20px 8px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(5px);
            animation: fadeInUp 0.5s ease;
            animation-fill-mode: both;
        }

        .menu-item:hover {
            transform: translateY(-5px);
            background: rgba(233, 69, 96, 0.2);
            border-color: #e94560;
            box-shadow: 0 10px 20px rgba(233, 69, 96, 0.3);
        }

        .menu-item span {
            font-size: 32px;
            filter: drop-shadow(0 4px 4px rgba(0,0,0,0.3));
        }

        .menu-item .label {
            font-size: 14px;
            font-weight: 500;
            color: #ffffff;
        }

        /* –ó–∞–≥–∞–ª—å–Ω—ñ –∫–∞—Ä—Ç–∫–∏ */
        .content-card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border-radius: 24px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            animation: fadeIn 0.5s ease;
        }

        .back-button {
            background: linear-gradient(45deg, #e94560, #ff6b6b);
            border: none;
            border-radius: 16px;
            padding: 14px 20px;
            color: white;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            margin: 16px 0;
            transition: transform 0.2s, box-shadow 0.2s;
            box-shadow: 0 4px 15px rgba(233, 69, 96, 0.4);
        }

        .back-button:hover {
            transform: scale(0.98);
            box-shadow: 0 6px 20px rgba(233, 69, 96, 0.6);
        }

        /* –ö–µ–π—Å–∏ */
        .case-item {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 16px;
            padding: 16px;
            margin-bottom: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid transparent;
        }

        .case-item:hover {
            border-color: #e94560;
            transform: translateX(5px);
            background: rgba(233, 69, 96, 0.1);
        }

        .case-name {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 4px;
        }

        .case-price {
            color: #e94560;
            font-size: 14px;
        }

        .case-description {
            font-size: 13px;
            color: #a0a0a0;
            margin-top: 8px;
        }

        /* –í–∏–±—ñ—Ä –∫—ñ–ª—å–∫–æ—Å—Ç—ñ */
        .count-selector {
            display: flex;
            gap: 10px;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .count-btn {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid #e94560;
            border-radius: 30px;
            padding: 10px 20px;
            font-size: 16px;
            color: white;
            cursor: pointer;
            flex: 1;
            transition: all 0.3s ease;
        }

        .count-btn.selected {
            background: #e94560;
            border-color: #e94560;
            box-shadow: 0 0 15px #e94560;
        }

        .count-btn:hover {
            background: rgba(233, 69, 96, 0.3);
        }

        /* –ê–Ω—ñ–º–∞—Ü—ñ—è –≤—ñ–¥–∫—Ä–∏—Ç—Ç—è –∫–µ–π—Å—É */
        @keyframes spin {
            0% { transform: rotate(0deg) scale(1); }
            50% { transform: rotate(180deg) scale(1.2); }
            100% { transform: rotate(360deg) scale(1); }
        }

        @keyframes cardFlip {
            0% { opacity: 0; transform: perspective(400px) rotateY(90deg); }
            100% { opacity: 1; transform: perspective(400px) rotateY(0); }
        }

        .case-opening-animation {
            animation: spin 1s ease-in-out;
        }

        .result-item {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 16px;
            padding: 16px;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 16px;
            border: 1px solid rgba(233, 69, 96, 0.3);
            animation: cardFlip 0.5s ease;
            transition: transform 0.3s;
        }

        .result-item:hover {
            transform: scale(1.02);
            border-color: #e94560;
        }

        .result-emoji {
            font-size: 48px;
            min-width: 60px;
            text-align: center;
        }

        .result-info {
            flex: 1;
        }

        .result-name {
            font-size: 18px;
            font-weight: bold;
        }

        .result-rarity {
            font-size: 14px;
            color: #a0a0a0;
        }

        .result-price {
            color: #e94560;
            font-size: 14px;
            margin-top: 4px;
        }

        /* –Ü–Ω–≤–µ–Ω—Ç–∞—Ä */
        .inventory-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }

        .inventory-item {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 16px;
            padding: 16px;
            text-align: center;
            border: 1px solid transparent;
            transition: all 0.3s ease;
        }

        .inventory-item:hover {
            border-color: #e94560;
            transform: translateY(-5px);
            background: rgba(233, 69, 96, 0.1);
        }

        .inventory-rarity {
            font-size: 32px;
            margin-bottom: 8px;
        }

        .inventory-name {
            font-weight: 500;
            font-size: 14px;
            word-break: break-word;
        }

        .inventory-price {
            color: #e94560;
            font-size: 13px;
            margin: 8px 0;
        }

        .sell-btn {
            background: #e94560;
            border: none;
            border-radius: 30px;
            padding: 8px 16px;
            color: white;
            font-size: 13px;
            cursor: pointer;
            width: 100%;
            transition: all 0.3s;
        }

        .sell-btn:hover {
            background: #ff6b6b;
            transform: scale(0.95);
        }

        /* –ü—Ä–æ—Ñ—ñ–ª—å */
        .profile-info p {
            margin: 12px 0;
            padding: 12px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 12px;
        }

        /* –ê–Ω—ñ–º–∞—Ü—ñ—ó */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideUp {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        @keyframes fadeInUp {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .hidden {
            display: none !important;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #a0a0a0;
        }
    </style>
</head>
<body>
    <div class="container" id="app">
        <!-- –ì–æ–ª–æ–≤–Ω–∏–π –µ–∫—Ä–∞–Ω -->
        <div id="mainScreen">
            <div class="welcome-card">
                <div class="welcome-title">–õ–∞—Å–∫–∞–≤–æ –ø—Ä–æ—Å–∏–º–æ, <span id="username">–ì—Ä–∞–≤—á–µ</span>!</div>
                <div class="welcome-text">
                    üéÆ GGStandoff Bot ‚Äî —Ü–µ –≤—ñ—Ä—Ç—É–∞–ª—å–Ω–∏–π —Å–≤—ñ—Ç —Å–∫—ñ–Ω—ñ–≤, –∫–µ–π—Å—ñ–≤ —Ç–∞ –¥—É–µ–ª–µ–π. 
                    –í—ñ–¥–∫—Ä–∏–≤–∞–π—Ç–µ –∫–µ–π—Å–∏, –∑–±–∏—Ä–∞–π—Ç–µ –∫–æ–ª–µ–∫—Ü—ñ—ó, –±–∏–π—Ç–µ—Å—è –∑ –¥—Ä—É–∑—è–º–∏ —Ç–∞ —Å—Ç–∞–≤–∞–π—Ç–µ –ª–µ–≥–µ–Ω–¥–æ—é!
                </div>
            </div>

            <div class="balance-card">
                <span class="balance-label">üí∞ –ë–∞–ª–∞–Ω—Å</span>
                <span class="balance-amount" id="balanceAmount">0</span>
            </div>

            <div class="menu-grid">
                <div class="menu-item" onclick="showCases()" style="animation-delay: 0.1s;">
                    <span>üì¶</span>
                    <span class="label">–ö–µ–π—Å–∏</span>
                </div>
                <div class="menu-item" onclick="showInventory()" style="animation-delay: 0.2s;">
                    <span>üéí</span>
                    <span class="label">–Ü–Ω–≤–µ–Ω—Ç–∞—Ä</span>
                </div>
                <div class="menu-item" onclick="showProfile()" style="animation-delay: 0.3s;">
                    <span>üë§</span>
                    <span class="label">–ü—Ä–æ—Ñ—ñ–ª—å</span>
                </div>
                <div class="menu-item" onclick="showMarket()" style="animation-delay: 0.4s;">
                    <span>üè™</span>
                    <span class="label">–ú–∞—Ä–∫–µ—Ç</span>
                </div>
                <div class="menu-item" onclick="showDuels()" style="animation-delay: 0.5s;">
                    <span>‚öîÔ∏è</span>
                    <span class="label">–î—É–µ–ª—ñ</span>
                </div>
                <div class="menu-item" onclick="showTournament()" style="animation-delay: 0.6s;">
                    <span>üèÜ</span>
                    <span class="label">–¢—É—Ä–Ω—ñ—Ä</span>
                </div>
            </div>
        </div>

        <!-- –ï–∫—Ä–∞–Ω –∫–µ–π—Å—ñ–≤ -->
        <div id="casesScreen" class="hidden">
            <button class="back-button" onclick="goBack()">‚óÄÔ∏è –ù–∞–∑–∞–¥</button>
            <div class="content-card">
                <h2 style="margin-bottom: 16px;">üì¶ –ö–µ–π—Å–∏</h2>
                <div id="casesList" class="case-list"></div>
            </div>
        </div>

        <!-- –î–µ—Ç–∞–ª—ñ –∫–µ–π—Å—É -->
        <div id="caseDetailScreen" class="hidden">
            <button class="back-button" onclick="showCases()">‚óÄÔ∏è –î–æ —Å–ø–∏—Å–∫—É</button>
            <div class="content-card">
                <h2 id="caseDetailName"></h2>
                <p id="caseDetailDesc" style="color: #a0a0a0; margin: 8px 0;"></p>
                <div class="balance-card" style="margin: 16px 0;">
                    <span>üí∞ –í–∞—à –±–∞–ª–∞–Ω—Å:</span>
                    <span class="balance-amount" id="caseDetailBalance">0</span>
                </div>
                <div class="count-selector" id="countSelector"></div>
                <button class="back-button" id="openCaseBtn" onclick="openCase()" style="margin-top: 0;">üîì –í—ñ–¥–∫—Ä–∏—Ç–∏</button>
            </div>
        </div>

        <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç–∏ –≤—ñ–¥–∫—Ä–∏—Ç—Ç—è -->
        <div id="resultScreen" class="hidden">
            <button class="back-button" onclick="goBackToCases()">‚óÄÔ∏è –ü—Ä–æ–¥–æ–≤–∂–∏—Ç–∏</button>
            <div class="content-card">
                <h2>üéâ –†–µ–∑—É–ª—å—Ç–∞—Ç–∏</h2>
                <div id="resultsList" class="case-opening-animation"></div>
                <div class="balance-card" style="margin-top: 16px;">
                    <span>üí∞ –ù–æ–≤–∏–π –±–∞–ª–∞–Ω—Å:</span>
                    <span class="balance-amount" id="newBalanceResult">0</span>
                </div>
            </div>
        </div>

        <!-- –Ü–Ω–≤–µ–Ω—Ç–∞—Ä -->
        <div id="inventoryScreen" class="hidden">
            <button class="back-button" onclick="goBack()">‚óÄÔ∏è –ù–∞–∑–∞–¥</button>
            <div class="content-card">
                <h2 style="margin-bottom: 16px;">üéí –Ü–Ω–≤–µ–Ω—Ç–∞—Ä</h2>
                <button class="back-button" onclick="sellAllInventory()" style="background: #ff9800; margin: 10px 0;">üí∞ –ü—Ä–æ–¥–∞—Ç–∏ –≤—Å—ñ</button>
                <div id="inventoryList" class="inventory-grid"></div>
            </div>
        </div>

        <!-- –ü—Ä–æ—Ñ—ñ–ª—å -->
        <div id="profileScreen" class="hidden">
            <button class="back-button" onclick="goBack()">‚óÄÔ∏è –ù–∞–∑–∞–¥</button>
            <div class="content-card">
                <h2 style="margin-bottom: 16px;">üë§ –ü—Ä–æ—Ñ—ñ–ª—å</h2>
                <div id="profileInfo" class="profile-info"></div>
            </div>
        </div>

        <!-- –ú–∞—Ä–∫–µ—Ç (–∑–∞–≥–ª—É—à–∫–∞) -->
        <div id="marketScreen" class="hidden">
            <button class="back-button" onclick="goBack()">‚óÄÔ∏è –ù–∞–∑–∞–¥</button>
            <div class="content-card">
                <h2>üè™ –ú–∞—Ä–∫–µ—Ç</h2>
                <p style="color: #a0a0a0; text-align: center; margin-top: 20px;">–†–æ–∑–¥—ñ–ª —É —Ä–æ–∑—Ä–æ–±—Ü—ñ. –ù–µ–∑–∞–±–∞—Ä–æ–º —Ç—É—Ç –∑'—è–≤–∏—Ç—å—Å—è –º–æ–∂–ª–∏–≤—ñ—Å—Ç—å –∫—É–ø—É–≤–∞—Ç–∏ —Ç–∞ –ø—Ä–æ–¥–∞–≤–∞—Ç–∏ —Å–∫—ñ–Ω–∏.</p>
            </div>
        </div>

        <!-- –î—É–µ–ª—ñ (–∑–∞–≥–ª—É—à–∫–∞) -->
        <div id="duelsScreen" class="hidden">
            <button class="back-button" onclick="goBack()">‚óÄÔ∏è –ù–∞–∑–∞–¥</button>
            <div class="content-card">
                <h2>‚öîÔ∏è –î—É–µ–ª—ñ</h2>
                <p style="color: #a0a0a0; text-align: center; margin-top: 20px;">–†–æ–∑–¥—ñ–ª —É —Ä–æ–∑—Ä–æ–±—Ü—ñ. –°–∫–æ—Ä–æ –≤–∏ –∑–º–æ–∂–µ—Ç–µ –±–∏—Ç–∏—Å—è –∑ —ñ–Ω—à–∏–º–∏ –≥—Ä–∞–≤—Ü—è–º–∏!</p>
            </div>
        </div>

        <!-- –¢—É—Ä–Ω—ñ—Ä (–∑–∞–≥–ª—É—à–∫–∞) -->
        <div id="tournamentScreen" class="hidden">
            <button class="back-button" onclick="goBack()">‚óÄÔ∏è –ù–∞–∑–∞–¥</button>
            <div class="content-card">
                <h2>üèÜ –¢—É—Ä–Ω—ñ—Ä</h2>
                <p style="color: #a0a0a0; text-align: center; margin-top: 20px;">–†–æ–∑–¥—ñ–ª —É —Ä–æ–∑—Ä–æ–±—Ü—ñ. –°–ª—ñ–¥–∫—É–π—Ç–µ –∑–∞ –∞–Ω–æ–Ω—Å–∞–º–∏!</p>
            </div>
        </div>
    </div>

    <script>
        // ==================== –ù–ê–õ–ê–®–¢–£–í–ê–ù–ù–Ø ====================
        // ‚ö†Ô∏è –í–°–¢–ê–í–¢–ï –°–Æ–î–ò –í–ê–® URL –í–Ü–î NGROK
        const API_BASE_URL = 'https://cowardly-vibrionic-tamera.ngrok-free.dev/api';

        let tg = window.Telegram.WebApp;
        let userId = tg.initDataUnsafe.user?.id;
        let userData = null;
        let currentCaseKey = null;
        let selectedCount = 1;
        let casesData = [];

        tg.expand();
        tg.ready();

        if (!userId) {
            userId = prompt("–í–≤–µ–¥—ñ—Ç—å –≤–∞—à Telegram ID –¥–ª—è —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è:", "123456789");
        }

        // –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –ø–æ—á–∞—Ç–∫–æ–≤–∏—Ö –¥–∞–Ω–∏—Ö
        loadProfile();

        async function apiCall(endpoint, data = {}) {
            data.user_id = userId;
            try {
                const response = await fetch(`${API_BASE_URL}/${endpoint}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                return await response.json();
            } catch (error) {
                console.error('API Error:', error);
                return { success: false, message: '–ü–æ–º–∏–ª–∫–∞ –∑\'—î–¥–Ω–∞–Ω–Ω—è –∑ —Å–µ—Ä–≤–µ—Ä–æ–º' };
            }
        }

        async function loadProfile() {
            const data = await apiCall('profile');
            if (data.success) {
                userData = data.profile;
                document.getElementById('username').innerText = userData.username || '–ì—Ä–∞–≤—á–µ';
                updateBalanceDisplay(userData.balance);
                loadCasesFromConfig();
            } else {
                showNotification('–ù–µ –≤–¥–∞–ª–æ—Å—è –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –ø—Ä–æ—Ñ—ñ–ª—å');
            }
        }

        function updateBalanceDisplay(balance) {
            document.getElementById('balanceAmount').innerText = balance;
            document.getElementById('caseDetailBalance').innerText = balance;
        }

        function loadCasesFromConfig() {
            casesData = [
                { key: "Standard Case", name: "‚ö™ –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∏–π –∫–µ–π—Å", price: 100, description: "–ë–∞–∑–æ–≤–∏–π –∫–µ–π—Å –∑—ñ –∑–≤–∏—á–∞–π–Ω–∏–º–∏ —Ç–∞ —Ä—ñ–¥–∫—ñ—Å–Ω–∏–º–∏ —Å–∫—ñ–Ω–∞–º–∏" },
                { key: "Premium Case", name: "üîµ –ü—Ä–µ–º—ñ—É–º –∫–µ–π—Å", price: 500, description: "–ö–µ–π—Å –∑ –≤–∏—â–∏–º–∏ —à–∞–Ω—Å–∞–º–∏ –Ω–∞ –µ–ø—ñ—á–Ω—ñ —Å–∫—ñ–Ω–∏" },
                { key: "Elite Case", name: "üü£ –ï–ª—ñ—Ç–Ω–∏–π –∫–µ–π—Å", price: 1000, description: "–ï–∫—Å–∫–ª—é–∑–∏–≤–Ω–∏–π –∫–µ–π—Å –∑ –º–æ–∂–ª–∏–≤—ñ—Å—Ç—é –≤–∏–±–∏—Ç–∏ –ª–µ–≥–µ–Ω–¥–∞—Ä–Ω—ñ —Å–∫—ñ–Ω–∏" },
                { key: "Ultimate Case", name: "üü† –£–ª—å—Ç–∏–º–∞—Ç –∫–µ–π—Å", price: 2500, description: "–ù–∞–π–∫—Ä–∞—â–∏–π –∫–µ–π—Å –∑ —à–∞–Ω—Å–æ–º –Ω–∞ –∞—Ä–∫–∞–Ω–Ω—ñ —Å–∫—ñ–Ω–∏!" }
            ];
            renderCasesList();
        }

        function renderCasesList() {
            const container = document.getElementById('casesList');
            let html = '';
            casesData.forEach(c => {
                html += `
                    <div class="case-item" onclick="selectCase('${c.key}')">
                        <div class="case-name">${c.name}</div>
                        <div class="case-price">üí∞ ${c.price} –º–æ–Ω–µ—Ç</div>
                        <div class="case-description">${c.description}</div>
                    </div>
                `;
            });
            container.innerHTML = html;
        }

        function selectCase(caseKey) {
            currentCaseKey = caseKey;
            const caseData = casesData.find(c => c.key === caseKey);
            document.getElementById('caseDetailName').innerText = caseData.name;
            document.getElementById('caseDetailDesc').innerText = caseData.description;

            const counts = [1, 2, 5, 10];
            let buttonsHtml = '';
            counts.forEach(count => {
                buttonsHtml += `<button class="count-btn ${count === 1 ? 'selected' : ''}" onclick="selectCount(${count})">${count}</button>`;
            });
            document.getElementById('countSelector').innerHTML = buttonsHtml;
            selectedCount = 1;

            hideAllScreens();
            document.getElementById('caseDetailScreen').classList.remove('hidden');
        }

        function selectCount(count) {
            selectedCount = count;
            document.querySelectorAll('.count-btn').forEach(btn => {
                btn.classList.remove('selected');
                if (btn.innerText == count) btn.classList.add('selected');
            });
        }

        async function openCase() {
            const caseData = casesData.find(c => c.key === currentCaseKey);
            if (!caseData) return;

            document.getElementById('openCaseBtn').disabled = true;
            document.getElementById('openCaseBtn').innerText = '‚è≥ –í—ñ–¥–∫—Ä–∏—Ç—Ç—è...';

            const result = await apiCall('open_case', {
                case_key: currentCaseKey,
                count: selectedCount
            });

            document.getElementById('openCaseBtn').disabled = false;
            document.getElementById('openCaseBtn').innerText = 'üîì –í—ñ–¥–∫—Ä–∏—Ç–∏';

            if (result.success) {
                if (result.new_balance !== undefined) {
                    updateBalanceDisplay(result.new_balance);
                }
                showResults(result.results, result.total_cost, result.new_balance);
            } else {
                alert(result.message || '–ü–æ–º–∏–ª–∫–∞ –≤—ñ–¥–∫—Ä–∏—Ç—Ç—è –∫–µ–π—Å—É');
            }
        }

        function showResults(results, totalCost, newBalance) {
            let html = '';
            results.forEach((r, index) => {
                html += `
                    <div class="result-item" style="animation-delay: ${index * 0.1}s">
                        <div class="result-emoji">${r.emoji}</div>
                        <div class="result-info">
                            <div class="result-name">${r.skin_name}</div>
                            <div class="result-rarity">${r.rarity}</div>
                            <div class="result-price">üí∞ ${r.sell_price} –º–æ–Ω–µ—Ç</div>
                            <div style="font-size: 12px; color: #666;">ID: ${r.skin_id}</div>
                        </div>
                    </div>
                `;
            });
            document.getElementById('resultsList').innerHTML = html;
            document.getElementById('newBalanceResult').innerText = newBalance || '?';

            hideAllScreens();
            document.getElementById('resultScreen').classList.remove('hidden');
        }

        async function showInventory() {
            hideAllScreens();
            document.getElementById('inventoryScreen').classList.remove('hidden');
            document.getElementById('inventoryList').innerHTML = '<div class="loading">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...</div>';

            const data = await apiCall('get_inventory');
            if (data.success) {
                renderInventory(data.inventory);
            } else {
                document.getElementById('inventoryList').innerHTML = '<p>–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —ñ–Ω–≤–µ–Ω—Ç–∞—Ä—è</p>';
            }
        }

        function renderInventory(items) {
            const container = document.getElementById('inventoryList');
            if (items.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #a0a0a0;">–Ü–Ω–≤–µ–Ω—Ç–∞—Ä –ø–æ—Ä–æ–∂–Ω—ñ–π</p>';
                return;
            }
            let html = '';
            items.forEach(item => {
                html += `
                    <div class="inventory-item">
                        <div class="inventory-rarity">${item.emoji}</div>
                        <div class="inventory-name">${item.skin_name}</div>
                        <div class="inventory-price">üí∞ ${item.sell_price}</div>
                        <button class="sell-btn" onclick="sellSkin(${item.id})">–ü—Ä–æ–¥–∞—Ç–∏</button>
                    </div>
                `;
            });
            container.innerHTML = html;
        }

        async function sellSkin(skinId) {
            if (!confirm('–ü—Ä–æ–¥–∞—Ç–∏ —Ü–µ–π —Å–∫—ñ–Ω?')) return;
            const result = await apiCall('sell_skin', { skin_id: skinId });
            if (result.success) {
                alert(result.message);
                updateBalanceDisplay(result.new_balance);
                showInventory();
            } else {
                alert(result.message);
            }
        }

        async function sellAllInventory() {
            if (!confirm('–ü—Ä–æ–¥–∞—Ç–∏ –í–°–Ü —Å–∫—ñ–Ω–∏ –∑ —ñ–Ω–≤–µ–Ω—Ç–∞—Ä—è? –¶—é –¥—ñ—é –Ω–µ–º–æ–∂–ª–∏–≤–æ —Å–∫–∞—Å—É–≤–∞—Ç–∏.')) return;
            const result = await apiCall('sell_all');
            if (result.success) {
                alert(result.message);
                updateBalanceDisplay(result.total);
                showInventory();
            } else {
                alert(result.message);
            }
        }

        async function showProfile() {
            hideAllScreens();
            document.getElementById('profileScreen').classList.remove('hidden');
            document.getElementById('profileInfo').innerHTML = '<div class="loading">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...</div>';

            const data = await apiCall('profile');
            if (data.success) {
                const p = data.profile;
                let html = `
                    <p><strong>ID:</strong> ${p.user_id}</p>
                    <p><strong>Username:</strong> @${p.username || '–Ω–µ–º–∞—î'}</p>
                    <p><strong>–ë–∞–ª–∞–Ω—Å:</strong> ${p.balance} –º–æ–Ω–µ—Ç</p>
                    <p><strong>–†—ñ–≤–µ–Ω—å:</strong> ${p.level} (XP: ${p.xp}/100)</p>
                    <p><strong>–ó–Ω–∏–∂–∫–∞:</strong> ${p.discount}%</p>
                    <p><strong>–í—ñ–¥–∫—Ä–∏—Ç–æ –∫–µ–π—Å—ñ–≤:</strong> ${p.cases_opened}</p>
                `;
                if (p.most_expensive_skin) {
                    html += `<p><strong>–ù–∞–π–¥–æ—Ä–æ–∂—á–∏–π —Å–∫—ñ–Ω:</strong> ${p.most_expensive_skin.skin_name} (${p.most_expensive_skin.rarity}) - ${p.most_expensive_skin.case_price} –º–æ–Ω–µ—Ç</p>`;
                }
                document.getElementById('profileInfo').innerHTML = html;
            } else {
                document.getElementById('profileInfo').innerHTML = '<p>–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –ø—Ä–æ—Ñ—ñ–ª—é</p>';
            }
        }

        function showMarket() {
            hideAllScreens();
            document.getElementById('marketScreen').classList.remove('hidden');
        }

        function showDuels() {
            hideAllScreens();
            document.getElementById('duelsScreen').classList.remove('hidden');
        }

        function showTournament() {
            hideAllScreens();
            document.getElementById('tournamentScreen').classList.remove('hidden');
        }

        function showCases() {
            hideAllScreens();
            document.getElementById('casesScreen').classList.remove('hidden');
        }

        function goBack() {
            hideAllScreens();
            document.getElementById('mainScreen').classList.remove('hidden');
        }

        function goBackToCases() {
            hideAllScreens();
            document.getElementById('casesScreen').classList.remove('hidden');
        }

        function hideAllScreens() {
            document.getElementById('mainScreen').classList.add('hidden');
            document.getElementById('casesScreen').classList.add('hidden');
            document.getElementById('caseDetailScreen').classList.add('hidden');
            document.getElementById('resultScreen').classList.add('hidden');
            document.getElementById('inventoryScreen').classList.add('hidden');
            document.getElementById('profileScreen').classList.add('hidden');
            document.getElementById('marketScreen').classList.add('hidden');
            document.getElementById('duelsScreen').classList.add('hidden');
            document.getElementById('tournamentScreen').classList.add('hidden');
        }

        function showNotification(msg) {
            alert(msg);
        }
    </script>
</body>
</html>
